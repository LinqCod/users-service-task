# User Service

Тестовое задание рефакторинга сервиса пользователей

## Основная задача

Необходимо было зарефакторить исходный сервис, работающий с бд пользователей, представленной в виде json файла.

## Старт сервиса

1. Клонируем репозиторий проекта:
```
git clone https://github.com/LinqCod/users-service-task.git
```
2. Дальше необходимо запустить само приложение. Сервис обернут в докер контейнер в целях более легкого развертывания и тестирования. Докерфайл представляет из себя multi-stage build для увеличения скорости сборки, а также уменьшения размеров итогового контейнера. Для конфигурирования контейнера сервиса использовался `docker-compose`, также сделано это было для дальнейшей возможности добавления иного типа БД и их легкой коммуникации.

### Команды

Для запуска сервиса достаточно использовать команду `make service-up`, которая сбилдит и запустит приложение, доступное на порту 3333:

```
make service-up
```

Для завершения работы сервиса следует воспользоваться командой:

```
make service-down
```

## Основные изменения: 
 1. Было решено изменить структуру проекта в целях его соответствия чистой архитектуре. Данная модификация улучшит читаемость кода, а также облегчит его расширение.
 2. Приложение было обернуто в докер контейнер, а также сконфигурировано, используя `docker-compose`. В частности, это было также сделано для дальнейшей возможности добавления взаимодействия с другими компонентами системы (контейнеры redis, postgres, брокеров сообщений и прочее), для последующего ее развертывания.
 3. Конфигурация сервиса обособлена в .env файл; для работы с ней используется библиотека `viper`. 
 4. Подчищен deprecated код для записи в файл.
 5. ошибки, а также http ответы вынесены в отдельные пакеты. 
 6. Добавлены файлы для хранения DTO и основных моделей приложения.
 7. БД также была вынесена в отдельный пакет, представлена структурой UserStore, а путь к ее json файлу описан в .env.
 8. Добавлено логирование (используется пакет `go.uber.org/zap`).
 9. Реализован механизм graceful shutdown для грамотного завершения сервиса.

## Что можно добавить в дальнейшем:
 1. Уйти от модели базы данных в формате json в сторону sql или nosql субд, в зависимости от технических требований, для более грамотной работы с данными. Плюсом хранение бд на сервере вместе с основным сервисом - не лучшая идея.
 2. Добавить механизм CI/CD для обеспечения более быстрого цикла разработки, тестирования и развёртывания приложения.
 3. Добавить механизм миграций бд для более грамотной работы с ее изменениями.
 4. Разумеется, упомянутая в тз авторизация пользователя. Добавить соответствующие эндпоинты и миддлвару.
 5. Покрыть систему детальными тестами.
 6. Добавить документацию апи (swagger).
